{"remainingRequest":"C:\\work\\竞猜可换色板\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\work\\竞猜可换色板\\src\\views\\personalCenter\\Myself.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\work\\竞猜可换色板\\src\\views\\personalCenter\\Myself.vue","mtime":1608885900115},{"path":"C:\\work\\竞猜可换色板\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\work\\竞猜可换色板\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\work\\竞猜可换色板\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\work\\竞猜可换色板\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport Vue from \"vue\";\r\nimport { Toast } from \"vant\";\r\nimport backB from \"@/components/Botton/back.vue\";\r\nVue.use(Toast);\r\nimport axios from \"axios\";\r\nimport {\r\n  apiGetUserInfo,\r\n  apiUploadImg,\r\n  apiChangePwd,\r\n  apiGetVipGrade\r\n} from \"@/api/User.js\";\r\nimport { apiUpload } from \"@/api/Upload.js\";\r\nimport { apiGetUnreadMessageCount, apiSetMessageRead } from \"@/api/Message.js\";\r\nimport { apiGetMissionUnGet } from \"@/api/mission.js\";\r\nimport back from \"@/components/Botton/back.vue\";\r\nimport colorChoice from \"@/components/ColorChoice.vue\";\r\nimport model from \"../../components/model\";\r\nimport { apiGetMemClubs } from \"@/api/Club.js\";\r\nexport default {\r\n  name: \"Myself\",\r\n  components: {\r\n    back,\r\n    colorChoice,\r\n    model\r\n  },\r\n  filters: {\r\n    Uname(val) {\r\n      if (val == \"\") {\r\n        return 100;\r\n      }\r\n    },\r\n    F(val) {\r\n      if (val == \"\") {\r\n        return \"no name\";\r\n      }\r\n    },\r\n    noName(name) {\r\n      if (name == null) {\r\n        return \"去设置昵称\";\r\n      } else {\r\n        return name;\r\n      }\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      infoList: [\r\n        [\r\n          {  topic: this.$t(\"MyRank\"),  routerName: \"rank\" , className: \"my-rank\"}, //【 我的排位 】\r\n          {  topic: this.$t(\"MyChallenge\"),  routerName: \"challengehome\", className: \"my-challenge\"}, //【 我的挑战 】\r\n          {  topic: this.$t(\"MyTask\"),  routerName: \"task\", className: \"my-mission\"},  //【 我的任务 】\r\n          {  topic: this.$t(\"MyMedal\"),  routerName: \"medal\", className: \"my-medal\"},  //【 我的勋章 】\r\n          {  topic: this.$t(\"Club\"),  routerName: \"CreateClub\", className: \"my-club\"}  //【 俱樂部 】\r\n        ],\r\n        [\r\n          {  topic: this.$t(\"Profile\"),  routerName: \"selfMsg\", className: \"my-selfMsg\"},  //【 个人讯息 】\r\n          {  topic: this.$t(\"Notification\"),  routerName: \"myMessage\", className: \"my-message\"},  //【 系统消息 】\r\n          {  topic: this.$t(\"CashFlowLog\"),  routerName: \"cashFlowLog\", className: \"my-cash-flow-log\"},  //【 金流日誌 】\r\n          {  topic: this.$t(\"BetList\"),  routerName: \"history\", className: \"my-history\"},  //【 竞猜历史 】\r\n          {  topic: this.$t(\"Result\"),  routerName: \"gameResult\", className: \"my-game-result\"},  //【 比赛结果 】\r\n          {  topic: this.$t(\"AddressManagement\"),  routerName: \"address\", className: \"my-address\"},  //【 地址管理 】\r\n          {  topic: this.$t(\"Guide\"),  routerName: \"guize\", className: \"my-guize\"},  //【 竞猜指南 】\r\n          {  topic: this.$t(\"Questionnaire\"),  routerName: \"questionnaire\", className: \"my-questionnaire\"},  //【 问卷调查 】\r\n          {  topic: this.$t(\"ChangeLanguage\"), routerName: \"lang\", className: \"my-lang\"},  //【 语种切换 】\r\n        ],\r\n        [\r\n          {  topic: this.$t(\"ChangePassword\"),  routerName: \"changePass\", className: \"my-change\"}  //【 修改密码 】\r\n        ]\r\n      ],\r\n      isAddress: false,\r\n      myMoney: 1000, //金币\r\n      myTicket: 20, //门票\r\n      myLottery: 5, //奖券\r\n      UImg: \"\",\r\n      msgList: {\r\n        UImg: \"\",\r\n        UDiamond: 0,\r\n        UTicket: 0, //门票\r\n        Lotteries: 0 //奖券\r\n      },\r\n      msgCount: 0,\r\n      unclaimedTaskReward: 0,\r\n      countNum: false,\r\n      testList: {},\r\n      msgMsg: \"\",\r\n      imgUrl: \"\",\r\n\r\n      showLan: false,\r\n      language: \"\",\r\n      langIndex: undefined,\r\n      langList: ['简体中文','繁體中文','English'],\r\n\r\n      showGuide: false,\r\n      token: false,\r\n      isExchangeBoxOpen: false //兌換彈窗\r\n    };\r\n  },\r\n  methods: {\r\n    goToPage(routerName) {\r\n\r\n      // 語系切換\r\n      if (routerName == \"lang\") {\r\n        this.showLan = true;\r\n        if (this.language == \"简体中文\") {\r\n          this.langIndex = 0;\r\n        } else if (this.language == \"繁體中文\") {\r\n          this.langIndex = 1;\r\n        }\r\n        else if (this.language == \"English\") {\r\n          this.langIndex = 2;\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (!this.token) {\r\n        const m = this.$message({\r\n          message: this.$t(\"Please_Login\"),  // 【 请登录 】\r\n          duration: 1000,\r\n          type: \"error\",\r\n          center: true\r\n        });\r\n        setTimeout(() => m.close(), 1200);\r\n        return;\r\n      }else{\r\n        // 俱樂部\r\n        if (routerName === \"CreateClub\") {\r\n          // 獲取俱樂部會員資格與否   1 = 有資格;  2 = 無資格\r\n          // let userName = localStorage.getItem('uname')\r\n          // let data = {}\r\n          apiGetMemClubs(\"\", true).then(res => {\r\n            if (res.Data == null) {\r\n              // 無會員\r\n              localStorage.setItem(\"isMember\", 2);\r\n              this.$router.push(\"/CreateClub\");\r\n            } else {\r\n              // 有會員\r\n              localStorage.setItem(\"isMember\", 1);\r\n              localStorage.setItem(\"ClubId\", res.Data.ClubId);\r\n              // 判斷是否為管理階級\r\n              if (res.Data.Name == \"会长\") {\r\n                localStorage.setItem(\"isManagement\", 1);\r\n              } else if (res.Data.Name == \"副会长\"){\r\n                localStorage.setItem(\"isManagement\", 2);\r\n              } else if (res.Data.Name == \"会员\"){\r\n                localStorage.setItem(\"isManagement\", 3);\r\n              }\r\n              this.$router.push(\"/myClub\");\r\n            }\r\n          });\r\n          return;\r\n        }\r\n        this.$router.push(\"/\" + routerName);\r\n        switch (routerName) {\r\n          //系统信息\r\n          case \"myMessage\":\r\n            this.$router.push(\"/myMessage\");\r\n            let data = {};\r\n            apiSetMessageRead(data, true).then(res => {\r\n              this.countNum = false;\r\n            });\r\n            break;\r\n  \r\n          default:\r\n            break;\r\n        }\r\n      }\r\n    },\r\n    goMyself() {\r\n      this.$router.push(\"/selfMsg\");\r\n    },\r\n    noVip() {\r\n      // let config = {\r\n      //   headers: { \"Content-Type\": \"application/json\" }\r\n      // };\r\n      // let urlL = 'https://api-sf.linsio.cn/api/Payment/OTCLogin';\r\n      // let param = {\r\n      //   '': '123456'\r\n      // }\r\n      // //  添加请求头\r\n      // axios.post(urlL, param, config).then(response => {\r\n      // })\r\n      this.$router.push(\"/vip\");\r\n    },\r\n\r\n    goRecharge() {\r\n      this.$router.push(\"/recharge\");\r\n    },\r\n    //兌換提示\r\n    // goShop() {\r\n    //   // this.$router.push(\"/shop\");  這版本先不用跳轉到商城，先跳一個警告訊息說敬請期待\r\n    //   const m = this.$message({\r\n    //       message: this.$t(\"ComingSoon\"),\r\n    //       duration: 1000,\r\n    //       type: \"success\",\r\n    //       center: true\r\n    //     });\r\n    //     setTimeout(() => m.close(), 1200);\r\n    //     return;\r\n    // },\r\n    goBackRes() {\r\n      this.$router.push(\"/yijian\");\r\n    },\r\n    goYao() {\r\n      this.$router.push(\"/invitationcode\");\r\n    },\r\n    goExchange() {\r\n      this.$router.push(\"/exchange\");\r\n    },\r\n\r\n    addressIn() {\r\n      this.isAddress = true;\r\n    },\r\n\r\n    layout() {\r\n      localStorage.removeItem(\"token\");\r\n      localStorage.setItem(\"shops\", \"[]\");\r\n      this.$router.push(\"/Login\");\r\n    },\r\n    goBack() {\r\n      this.$router.go(-1);\r\n      // let data = {}\r\n      // this.$store.dispatch(\"getMsgList\", data);\r\n    },\r\n\r\n    getMsg() {\r\n      let data = {};\r\n      apiGetUserInfo(data, true).then(res => {\r\n        //有token要加ture\r\n        this.msgList = res;\r\n        this.msgList.UImg = res.UImg;\r\n        localStorage.setItem(\"RankId\", res.RankId);\r\n        localStorage.setItem(\"nickName\", res.NickName);\r\n        localStorage.setItem(\"UImg\", res.UImg);\r\n      });\r\n    },\r\n\r\n    getMsgNum() {\r\n      let data = {};\r\n      apiGetUnreadMessageCount(data, true).then(res => {\r\n        this.msgCount = res.UnreadMessageCount;\r\n        if (this.msgCount > 0) {\r\n          this.countNum = true;\r\n        }\r\n      });\r\n    },\r\n\r\n    getUnclaimedTaskReward() {\r\n      let data = {};\r\n      apiGetMissionUnGet(data, true).then(res => {\r\n        this.unclaimedTaskReward = res.Count;\r\n      });\r\n    },\r\n    // 上传图片\r\n    updataImg(e) {\r\n      var file = e.target.files[0];\r\n      // 获取图片的大小，做大小限制有用\r\n      let imgSize = file.size;\r\n      //图片压缩就是处理file\r\n\r\n      this.imgPreview(file);\r\n\r\n      var _this = this; // this指向问题，所以在外面先定义\r\n      if (imgSize <= 1024 * 1024) {\r\n\r\n        const imgName = JSON.stringify(file.name);\r\n        let param = new FormData(); // 创建form对象\r\n        param.append(\"file\", file, file.name); // 通过append向form对象添加数据\r\n        let config = {\r\n          headers: {\r\n            \"Content-Type\": \"multipart/form-data\"\r\n          }\r\n        };\r\n        let urlL = process.env.VUE_APP_API_BASE_URL + \"/Uploader/UploadImg\";\r\n        //  添加请求头\r\n        axios.post(urlL, param, config).then(response => {\r\n          if (response.status == 200) {\r\n            // 成功上传后处理逻辑\r\n            this.msgMsg = response.data.Msg;\r\n            this.msgList.UImg = response.data.Data.Url;\r\n            this.$Alert.showSuccess.call(this, this.msgMsg);\r\n            let data = {\r\n              UImg: this.msgList.UImg\r\n            };\r\n            apiUploadImg(data, true).then(res => {\r\n              if (res.Status == 1) {\r\n                // localStorage.setItem('imgs', this.imgUrl)\r\n              }\r\n            });\r\n          }\r\n        });\r\n      } else {\r\n        this.$Alert.showWarning.call(this, \"图片太大啦！\");\r\n      }\r\n    },\r\n    imgPreview(file) {\r\n      let self = this;\r\n      let Orientation;\r\n      // 创建一个reader\r\n      let reader = new FileReader();\r\n      // 将图片2将转成 base64 格式\r\n      reader.readAsDataURL(file);\r\n      reader.onloadend = function() {\r\n        let result = this.result;\r\n        let img = new Image();\r\n        img.src = result;\r\n        //判断图片是否大于100K,是就直接上传，反之压缩图片\r\n        if (this.result.length <= 1024 * 1024) {\r\n          self.headerImage = this.result;\r\n        } else {\r\n          img.onload = function() {\r\n            let data = self.compress(img, Orientation);\r\n            self.headerImage = data;\r\n          };\r\n        }\r\n      };\r\n    },\r\n    compress(img, Orientation) {\r\n      let canvas = document.createElement(\"canvas\");\r\n      let ctx = canvas.getContext(\"2d\");\r\n      //瓦片canvas\r\n      let tCanvas = document.createElement(\"canvas\");\r\n      let tctx = tCanvas.getContext(\"2d\");\r\n      let initSize = img.src.length;\r\n      let width = img.width;\r\n      let height = img.height;\r\n      //如果图片大于四百万像素，计算压缩比并将大小压至400万以下\r\n      let ratio;\r\n      if ((ratio = (width * height) / 4000000) > 1) {\r\n        ratio = Math.sqrt(ratio);\r\n        width /= ratio;\r\n        height /= ratio;\r\n      } else {\r\n        ratio = 1;\r\n      }\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n      //        铺底色\r\n      ctx.fillStyle = \"#fff\";\r\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n      //如果图片像素大于100万则使用瓦片绘制\r\n      let count;\r\n      if ((count = (width * height) / 1000000) > 1) {\r\n        count = ~~(Math.sqrt(count) + 1); //计算要分成多少块瓦片\r\n        //            计算每块瓦片的宽和高\r\n        let nw = ~~(width / count);\r\n        let nh = ~~(height / count);\r\n        tCanvas.width = nw;\r\n        tCanvas.height = nh;\r\n        for (let i = 0; i < count; i++) {\r\n          for (let j = 0; j < count; j++) {\r\n            tctx.drawImage(\r\n              img,\r\n              i * nw * ratio,\r\n              j * nh * ratio,\r\n              nw * ratio,\r\n              nh * ratio,\r\n              0,\r\n              0,\r\n              nw,\r\n              nh\r\n            );\r\n            ctx.drawImage(tCanvas, i * nw, j * nh, nw, nh);\r\n          }\r\n        }\r\n      } else {\r\n        ctx.drawImage(img, 0, 0, width, height);\r\n      }\r\n      //修复ios上传图片的时候 被旋转的问题\r\n      if (Orientation != \"\" && Orientation != 1) {\r\n        switch (Orientation) {\r\n          case 6: //需要顺时针（向左）90度旋转\r\n            this.rotateImg(img, \"left\", canvas);\r\n            break;\r\n          case 8: //需要逆时针（向右）90度旋转\r\n            this.rotateImg(img, \"right\", canvas);\r\n            break;\r\n          case 3: //需要180度旋转\r\n            this.rotateImg(img, \"right\", canvas); //转两次\r\n            this.rotateImg(img, \"right\", canvas);\r\n            break;\r\n        }\r\n      }\r\n      //进行最小压缩\r\n      let ndata = canvas.toDataURL(\"image/jpeg\", 0.1);\r\n      //\"压缩前：\" + initSize\r\n      //\"压缩后：\" + ndata.length\r\n      //\"压缩率：\" + ~~((100 * (initSize - ndata.length)) / initSize) + \"%\"\r\n      tCanvas.width = tCanvas.height = canvas.width = canvas.height = 0;\r\n      return ndata;\r\n    },\r\n\r\n    // 語系初始化\r\n    langInit() {\r\n      this.language = JSON.parse(localStorage.getItem(\"lang\")).name;\r\n    },\r\n\r\n    // 語系彈窗選擇\r\n    langChoice(index) {\r\n      this.langIndex = index;\r\n    },\r\n\r\n    // 關閉語系選擇彈窗\r\n    cancel() {\r\n      this.showLan = false;\r\n    },\r\n\r\n    // 確定選擇語言\r\n    confirm() {\r\n      if (this.langIndex == 0) {\r\n        localStorage.setItem(\"lang\", JSON.stringify({ name: \"简体中文\", tag: \"zh-CN\" }));\r\n      } else if (this.langIndex == 1) {\r\n        localStorage.setItem(\"lang\", JSON.stringify({ name: \"繁體中文\", tag: \"zh-TW\" }));\r\n      }\r\n      else if (this.langIndex == 2) {\r\n        localStorage.setItem(\"lang\", JSON.stringify({ name: \"English\", tag: \"en-US\" }));\r\n      }\r\n      location.reload();\r\n    },\r\n\r\n    // 競猜指南暫時用確認按鈕\r\n    ComingSoon() {\r\n      this.showGuide = false;\r\n    },\r\n    //跳轉登入頁\r\n    login() {\r\n      this.$router.push(\"/Login\");\r\n    }\r\n  },\r\n  mounted() {\r\n    if (this.token) {\r\n      this.getMsg();\r\n      this.getMsgNum();\r\n      this.getUnclaimedTaskReward();\r\n    }\r\n    this.langInit();\r\n  },\r\n  created() {\r\n    localStorage.getItem(\"token\") ? this.token = true : this.token = false;\r\n  }\r\n};\r\n",{"version":3,"sources":["Myself.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6SA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Myself.vue","sourceRoot":"src/views/personalCenter","sourcesContent":["<template>\r\n  <main class=\"myself\" style=\"position: relative;\">\r\n    <div class=\"myself-header\" style=\"\">\r\n      <!-- <back-b  @click=\"goBack\" class=\"back-icon\"></back-b> -->\r\n      <back class=\"back-icon img-he\"></back>\r\n      <!-- <img\r\n        class=\"imgI\"\r\n        @click=\"layout\"\r\n        src=\"@/assets/guanbi.png\"\r\n        style=\"float:right;width:.42rem;height:.42rem;margin:.45rem .48rem 0 0\"\r\n      /> -->\r\n      <div class=\"logout\" @click=\"layout\" v-if=\"token\"></div>\r\n      <div class=\"myself-header-name\" v-if=\"token\">\r\n        <!-- accept解决图片筛选问题 -->\r\n        <!-- <span class='bestWord'>{{msgList.RankName}}</span> -->\r\n        <!-- <img class='bigImgs' src='@/assets/vip_03.png' /> -->\r\n        <input\r\n          class=\"inputImg\"\r\n          type=\"file\"\r\n          name=\"image\"\r\n          accept=\"image/*\"\r\n          @change=\"updataImg\"\r\n          style=\"display:none\"\r\n        />\r\n        <div @click=\"goMyself\" class=\"bgBoss\">\r\n          <img\r\n            class=\"upImg\"\r\n            :src=\"\r\n              msgList.UImg == '' ? require('@/assets/head.png') : msgList.UImg\r\n            \"\r\n          />\r\n          <!-- <img class=\"upImg\" :src='UImg' /> -->\r\n          <img\r\n            class=\"vips\"\r\n            src=\"@/assets/vip/V1.png\"\r\n            alt=\"\"\r\n            v-if=\"msgList.RankId == '1'\"\r\n          />\r\n          <img\r\n            class=\"vips\"\r\n            src=\"@/assets/vip/V2.png\"\r\n            alt=\"\"\r\n            v-if=\"msgList.RankId == '2'\"\r\n          />\r\n          <img\r\n            class=\"vips\"\r\n            src=\"@/assets/vip/V3.png\"\r\n            alt=\"\"\r\n            v-if=\"msgList.RankId == '3'\"\r\n          />\r\n          <img\r\n            class=\"vips\"\r\n            src=\"@/assets/vip/V4.png\"\r\n            alt=\"\"\r\n            v-if=\"msgList.RankId == '4'\"\r\n          />\r\n          <img\r\n            class=\"vips\"\r\n            src=\"@/assets/vip/V5.png\"\r\n            alt=\"\"\r\n            v-if=\"msgList.RankId == '5'\"\r\n          />\r\n          <img\r\n            class=\"vips\"\r\n            src=\"@/assets/vip/V6.png\"\r\n            alt=\"\"\r\n            v-if=\"msgList.RankId == '6'\"\r\n          />\r\n          <img\r\n            class=\"vips\"\r\n            src=\"@/assets/vip/V7.png\"\r\n            alt=\"\"\r\n            v-if=\"msgList.RankId == '7'\"\r\n          />\r\n          <img\r\n            class=\"vips\"\r\n            src=\"@/assets/vip/V8.png\"\r\n            alt=\"\"\r\n            v-if=\"msgList.RankId == '8'\"\r\n          />\r\n          <img\r\n            class=\"vips\"\r\n            src=\"@/assets/vip/V9.png\"\r\n            alt=\"\"\r\n            v-if=\"msgList.RankId == '9'\"\r\n          />\r\n          <img\r\n            class=\"vips\"\r\n            src=\"@/assets/vip/V10.png\"\r\n            alt=\"\"\r\n            v-if=\"msgList.RankId == '10'\"\r\n          />\r\n        </div>\r\n\r\n        <p\r\n          class=\"upName\"\r\n          style=\"text-align:center;font-size: .26rem;margin-left: -.28rem;width: 1.9rem\"\r\n        >\r\n          {{ msgList.NickName | noName }}\r\n        </p>\r\n        <!-- | noName(name) -->\r\n      </div>\r\n      <ul class=\"headerImgList\" v-if=\"token\">\r\n        <li class=\"my-header-list-wrap\" @click=\"goRecharge()\">\r\n          <div class=\"my-header-list-1\"></div>\r\n          <div class=\"my-header-list-text\">{{ $t('Deposit') }}</div>  <!--【 充值 】-->\r\n        </li>\r\n        <li class=\"my-header-list-wrap\" @click=\"noVip\">\r\n          <!-- <van-image\r\n            class=\"imgss\"\r\n            :src=\"require('@/assets/myself_05.png')\"\r\n            alt\r\n          /> -->\r\n          <div class=\"my-header-list-2\"></div>\r\n          <div class=\"my-header-list-text\">{{ $t('VIP') }}</div>  <!-- 【 VIP 】 -->\r\n        </li>\r\n        <li class=\"my-header-list-wrap\">\r\n          <router-link to=\"/InvitationCode\">\r\n            <!-- <van-image\r\n              class=\"imgss\"\r\n              :src=\"require('@/assets/myself_07.png')\"\r\n              alt\r\n            /> -->\r\n            <div class=\"my-header-list-3\"></div>\r\n            <div class=\"my-header-list-text\">{{ $t('Invite') }}</div>  <!-- 【 邀请 】 -->\r\n          </router-link>\r\n        </li>\r\n        <li class=\"my-header-list-wrap\" @click=\"isExchangeBoxOpen=true\">\r\n          <!-- <van-image\r\n            class=\"imgss\"\r\n            :src=\"require('@/assets/myself_09.png')\"\r\n            alt\r\n          /> -->\r\n          <div class=\"my-header-list-4\"></div>\r\n          <div class=\"my-header-list-text\">{{ $t('Exchange') }}</div>  <!-- 【 兑换 】 -->\r\n        </li>\r\n      </ul>\r\n      <div v-else class=\"noLogin\">\r\n        <div class=\"noLogin-title\">{{ $t('WelcomeLogin') }}</div>\r\n        <div class=\"noLogin-login\" @click=\"login()\">{{ $t('ClickLogin') }}</div>\r\n      </div>\r\n    </div>\r\n    <div class=\"myself-content\">\r\n      <img src=\"@/assets/qian_03.png\" />\r\n      <span class=\"myself-content-wallet\">{{ $t('Wallet') }}</span>  <!-- 【 我的钱包 】 -->\r\n      <p class=\"myself-content-line\"></p>\r\n      <ul class=\"myself-content-ul\">\r\n        <li class=\"myself-content-ul-item\">\r\n          <p class=\"myself-content-ul-item-num\">{{ msgList.UDiamond }}</p>\r\n          <p class=\"myself-content-ul-item-ward\">{{ $t('Coins') }}</p>  <!-- 【 金币 】 -->\r\n        </li>\r\n        <li class=\"myself-content-ul-item\">\r\n          <p class=\"myself-content-ul-item-num\">{{ msgList.UTicket }}</p>\r\n          <p class=\"myself-content-ul-item-ward\">{{ $t('Tickets') }}</p>  <!-- 【 门票 】 -->\r\n        </li>\r\n        <li class=\"myself-content-ul-item\">\r\n          <p class=\"myself-content-ul-item-num\">{{ msgList.Lotteries }}</p>\r\n          <p class=\"myself-content-ul-item-ward\">{{ $t('Lottery') }}</p>  <!-- 【 奖券 】 -->\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <div class=\"myself-list\" id=\"list\">\r\n      <div class=\"myself-list-big\" style=\"margin-top: .2rem\">\r\n        <div\r\n          class=\"myself-list-big-plet\"\r\n          @click=\"goToPage(myData.routerName)\"\r\n          v-for=\"(myData, index) in infoList[0]\"\r\n        >\r\n          <!-- <img\r\n            class=\"imgI\"\r\n            :src=\"myData.imgUrl\"\r\n            alt\r\n            style=\"margin-left: .5rem\"\r\n          /> -->\r\n\r\n          <div class=\"list-img\" :class=\"myData.className\"></div>\r\n          <span class=\"myself-list-big-plet-ward\"> {{ myData.topic }}</span>\r\n          <span\r\n            class=\"spanNum\"\r\n            v-show=\"myData.routerName == 'task' && unclaimedTaskReward > 0\"\r\n            >{{ unclaimedTaskReward }}</span\r\n          >\r\n          <img\r\n            src=\"@/assets/myself/leftjian.png\"\r\n            class=\"myself-list-big-plet-right\"\r\n          />\r\n        </div>\r\n      </div>\r\n      <div class=\"myself-list-big\" style=\"margin-top: .2rem\">\r\n        <div\r\n          class=\"myself-list-big-plet\"\r\n          @click=\"goToPage(listData.routerName)\"\r\n          v-for=\"(listData, index) in infoList[1]\"\r\n        >\r\n          <!-- <img class=\"imgI\" :src=\"listData.imgUrl\" alt /> -->\r\n          <div class=\"list-img\" :class=\"listData.className\"></div>\r\n          <span class=\"myself-list-big-plet-ward\">{{ listData.topic }}</span>\r\n          <span\r\n            class=\"spanNum\"\r\n            v-show=\"listData.routerName == 'myMessage' && countNum\"\r\n            >{{ msgCount }}</span\r\n          >\r\n          <span\r\n            class=\"current-lang\"\r\n            v-show=\"listData.routerName == 'lang'\"\r\n            >{{ language }}</span\r\n          >\r\n          <img\r\n            src=\"@/assets/myself/leftjian.png\"\r\n            class=\"myself-list-big-plet-right\"\r\n          />\r\n        </div>\r\n\r\n        <!-- <p\r\n          class=\"myself-list-big-plet1\"\r\n          @click=\"goExchange\"\r\n        >\r\n          <img\r\n          class='imgI'\r\n            src='@/assets/duihuan.png'\r\n            alt\r\n          />\r\n          <span class=\"myself-list-big-plet-ward\">兑换记录</span>\r\n          <img\r\n            src=\"@/assets/myself/leftjian.png\"\r\n            class=\"myself-list-big-plet-right\"\r\n          />\r\n        </p> -->\r\n\r\n        <!-- <p\r\n          class=\"myself-list-big-plet1\"\r\n          @click=\"goBackRes\"\r\n          style=\"border: 0\"\r\n        >\r\n          <img\r\n          class='imgI'\r\n            src='@/assets/myself/mys_19.jpg'\r\n            alt\r\n            style=\"height:.24rem;width:.24rem\"\r\n          />\r\n          <span class=\"myself-list-big-plet-ward\">意见反馈</span>\r\n          <img\r\n            src=\"@/assets/myself/leftjian.png\"\r\n            class=\"myself-list-big-plet-right\"\r\n          />\r\n        </p> -->\r\n      </div>\r\n      <div  class=\"myself-list-rank\"  style=\"margin-top: .2rem\"  @click=\"goToPage(userData.routerName)\"  v-for=\"(userData, index) in infoList[2]\">\r\n        <!-- <img class=\"imgI\"  :src=\"userData.imgUrl\"  alt  style=\"margin-left: .6rem\"/> -->\r\n        <div class=\"list-img\" :class=\"userData.className\"></div>\r\n        <span class=\"myself-list-rank-ward\">{{ userData.topic }}</span>\r\n        <img  src=\"@/assets/myself/leftjian.png\"  class=\"myself-list-rank-right\"  style=\"margin-right:0.42rem\"/>\r\n      </div>\r\n\r\n      <!-- 色系選擇 -->\r\n      <colorChoice />\r\n    </div>\r\n    <!-- 語系遮罩 -->\r\n    <transition name=\"fade\">\r\n      <model v-if=\"showLan\"></model>\r\n    </transition>\r\n    <transition name=\"fade\">\r\n      <div class=\"lang-select-wrap\" v-if=\"showLan\">\r\n        <p v-for=\"(lang, index) in langList\" :class=\"{'focus' : langIndex == index}\" @click=\"langChoice(index)\">{{ lang }}</p>\r\n        <div class=\"lang-btn-wrap\">\r\n          <div class=\"lang-btn cancel\" @click=\"cancel()\">{{ $t(\"Cancel\") }}</div>  <!-- 【 取消 】 -->\r\n          <div class=\"lang-btn\" @click=\"confirm()\">{{ $t(\"Confirm\") }}</div>  <!-- 【 确认 】 -->\r\n        </div>\r\n      </div>\r\n    </transition>\r\n\r\n    <!-- 競猜指南暫時用彈窗 -->\r\n    <!-- <transition name=\"fade\">\r\n      <model v-if=\"showGuide\"></model>\r\n    </transition>\r\n    <transition name=\"fade\">\r\n      <div class=\"guide-wrap\" v-if=\"showGuide\">\r\n        <p>{{ $t(\"ComingSoon\") }}</p>\r\n        <div class=\"guide-btn\" @click=\"ComingSoon()\">{{ $t(\"Confirm\") }}</div>\r\n      </div>\r\n    </transition> -->\r\n\r\n    <!-- 兌換彈窗 -->\r\n    <transition name=\"fade\">\r\n\t\t  <model v-if=\"isExchangeBoxOpen\"></model>\r\n\t  </transition>\r\n\t  <transition name=\"fade\">\r\n\t\t<div class=\"fancy-box\" v-if=\"isExchangeBoxOpen\">\r\n\t\t\t<img src=\"../../assets/club/ticket-header.png\" alt=\"\">\r\n      <div class=\"fancy-box-content\">\r\n\t\t\t  <p>{{ $t('Tips') }} : {{ $t('exchangePopupContent') }}</p>\r\n        <p>{{ $t('ComingSoon') }}</p>\r\n      </div>\r\n\t\t\t<div class=\"fancy-box-btn\">\r\n\t\t\t\t<div class=\"fancy-box-btn-cancel\" @click=\"isExchangeBoxOpen = !isExchangeBoxOpen\">{{ $t('Confirm') }}</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</transition>\r\n  </main>\r\n</template>\r\n<script>\r\nimport Vue from \"vue\";\r\nimport { Toast } from \"vant\";\r\nimport backB from \"@/components/Botton/back.vue\";\r\nVue.use(Toast);\r\nimport axios from \"axios\";\r\nimport {\r\n  apiGetUserInfo,\r\n  apiUploadImg,\r\n  apiChangePwd,\r\n  apiGetVipGrade\r\n} from \"@/api/User.js\";\r\nimport { apiUpload } from \"@/api/Upload.js\";\r\nimport { apiGetUnreadMessageCount, apiSetMessageRead } from \"@/api/Message.js\";\r\nimport { apiGetMissionUnGet } from \"@/api/mission.js\";\r\nimport back from \"@/components/Botton/back.vue\";\r\nimport colorChoice from \"@/components/ColorChoice.vue\";\r\nimport model from \"../../components/model\";\r\nimport { apiGetMemClubs } from \"@/api/Club.js\";\r\nexport default {\r\n  name: \"Myself\",\r\n  components: {\r\n    back,\r\n    colorChoice,\r\n    model\r\n  },\r\n  filters: {\r\n    Uname(val) {\r\n      if (val == \"\") {\r\n        return 100;\r\n      }\r\n    },\r\n    F(val) {\r\n      if (val == \"\") {\r\n        return \"no name\";\r\n      }\r\n    },\r\n    noName(name) {\r\n      if (name == null) {\r\n        return \"去设置昵称\";\r\n      } else {\r\n        return name;\r\n      }\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      infoList: [\r\n        [\r\n          {  topic: this.$t(\"MyRank\"),  routerName: \"rank\" , className: \"my-rank\"}, //【 我的排位 】\r\n          {  topic: this.$t(\"MyChallenge\"),  routerName: \"challengehome\", className: \"my-challenge\"}, //【 我的挑战 】\r\n          {  topic: this.$t(\"MyTask\"),  routerName: \"task\", className: \"my-mission\"},  //【 我的任务 】\r\n          {  topic: this.$t(\"MyMedal\"),  routerName: \"medal\", className: \"my-medal\"},  //【 我的勋章 】\r\n          {  topic: this.$t(\"Club\"),  routerName: \"CreateClub\", className: \"my-club\"}  //【 俱樂部 】\r\n        ],\r\n        [\r\n          {  topic: this.$t(\"Profile\"),  routerName: \"selfMsg\", className: \"my-selfMsg\"},  //【 个人讯息 】\r\n          {  topic: this.$t(\"Notification\"),  routerName: \"myMessage\", className: \"my-message\"},  //【 系统消息 】\r\n          {  topic: this.$t(\"CashFlowLog\"),  routerName: \"cashFlowLog\", className: \"my-cash-flow-log\"},  //【 金流日誌 】\r\n          {  topic: this.$t(\"BetList\"),  routerName: \"history\", className: \"my-history\"},  //【 竞猜历史 】\r\n          {  topic: this.$t(\"Result\"),  routerName: \"gameResult\", className: \"my-game-result\"},  //【 比赛结果 】\r\n          {  topic: this.$t(\"AddressManagement\"),  routerName: \"address\", className: \"my-address\"},  //【 地址管理 】\r\n          {  topic: this.$t(\"Guide\"),  routerName: \"guize\", className: \"my-guize\"},  //【 竞猜指南 】\r\n          {  topic: this.$t(\"Questionnaire\"),  routerName: \"questionnaire\", className: \"my-questionnaire\"},  //【 问卷调查 】\r\n          {  topic: this.$t(\"ChangeLanguage\"), routerName: \"lang\", className: \"my-lang\"},  //【 语种切换 】\r\n        ],\r\n        [\r\n          {  topic: this.$t(\"ChangePassword\"),  routerName: \"changePass\", className: \"my-change\"}  //【 修改密码 】\r\n        ]\r\n      ],\r\n      isAddress: false,\r\n      myMoney: 1000, //金币\r\n      myTicket: 20, //门票\r\n      myLottery: 5, //奖券\r\n      UImg: \"\",\r\n      msgList: {\r\n        UImg: \"\",\r\n        UDiamond: 0,\r\n        UTicket: 0, //门票\r\n        Lotteries: 0 //奖券\r\n      },\r\n      msgCount: 0,\r\n      unclaimedTaskReward: 0,\r\n      countNum: false,\r\n      testList: {},\r\n      msgMsg: \"\",\r\n      imgUrl: \"\",\r\n\r\n      showLan: false,\r\n      language: \"\",\r\n      langIndex: undefined,\r\n      langList: ['简体中文','繁體中文','English'],\r\n\r\n      showGuide: false,\r\n      token: false,\r\n      isExchangeBoxOpen: false //兌換彈窗\r\n    };\r\n  },\r\n  methods: {\r\n    goToPage(routerName) {\r\n\r\n      // 語系切換\r\n      if (routerName == \"lang\") {\r\n        this.showLan = true;\r\n        if (this.language == \"简体中文\") {\r\n          this.langIndex = 0;\r\n        } else if (this.language == \"繁體中文\") {\r\n          this.langIndex = 1;\r\n        }\r\n        else if (this.language == \"English\") {\r\n          this.langIndex = 2;\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (!this.token) {\r\n        const m = this.$message({\r\n          message: this.$t(\"Please_Login\"),  // 【 请登录 】\r\n          duration: 1000,\r\n          type: \"error\",\r\n          center: true\r\n        });\r\n        setTimeout(() => m.close(), 1200);\r\n        return;\r\n      }else{\r\n        // 俱樂部\r\n        if (routerName === \"CreateClub\") {\r\n          // 獲取俱樂部會員資格與否   1 = 有資格;  2 = 無資格\r\n          // let userName = localStorage.getItem('uname')\r\n          // let data = {}\r\n          apiGetMemClubs(\"\", true).then(res => {\r\n            if (res.Data == null) {\r\n              // 無會員\r\n              localStorage.setItem(\"isMember\", 2);\r\n              this.$router.push(\"/CreateClub\");\r\n            } else {\r\n              // 有會員\r\n              localStorage.setItem(\"isMember\", 1);\r\n              localStorage.setItem(\"ClubId\", res.Data.ClubId);\r\n              // 判斷是否為管理階級\r\n              if (res.Data.Name == \"会长\") {\r\n                localStorage.setItem(\"isManagement\", 1);\r\n              } else if (res.Data.Name == \"副会长\"){\r\n                localStorage.setItem(\"isManagement\", 2);\r\n              } else if (res.Data.Name == \"会员\"){\r\n                localStorage.setItem(\"isManagement\", 3);\r\n              }\r\n              this.$router.push(\"/myClub\");\r\n            }\r\n          });\r\n          return;\r\n        }\r\n        this.$router.push(\"/\" + routerName);\r\n        switch (routerName) {\r\n          //系统信息\r\n          case \"myMessage\":\r\n            this.$router.push(\"/myMessage\");\r\n            let data = {};\r\n            apiSetMessageRead(data, true).then(res => {\r\n              this.countNum = false;\r\n            });\r\n            break;\r\n  \r\n          default:\r\n            break;\r\n        }\r\n      }\r\n    },\r\n    goMyself() {\r\n      this.$router.push(\"/selfMsg\");\r\n    },\r\n    noVip() {\r\n      // let config = {\r\n      //   headers: { \"Content-Type\": \"application/json\" }\r\n      // };\r\n      // let urlL = 'https://api-sf.linsio.cn/api/Payment/OTCLogin';\r\n      // let param = {\r\n      //   '': '123456'\r\n      // }\r\n      // //  添加请求头\r\n      // axios.post(urlL, param, config).then(response => {\r\n      // })\r\n      this.$router.push(\"/vip\");\r\n    },\r\n\r\n    goRecharge() {\r\n      this.$router.push(\"/recharge\");\r\n    },\r\n    //兌換提示\r\n    // goShop() {\r\n    //   // this.$router.push(\"/shop\");  這版本先不用跳轉到商城，先跳一個警告訊息說敬請期待\r\n    //   const m = this.$message({\r\n    //       message: this.$t(\"ComingSoon\"),\r\n    //       duration: 1000,\r\n    //       type: \"success\",\r\n    //       center: true\r\n    //     });\r\n    //     setTimeout(() => m.close(), 1200);\r\n    //     return;\r\n    // },\r\n    goBackRes() {\r\n      this.$router.push(\"/yijian\");\r\n    },\r\n    goYao() {\r\n      this.$router.push(\"/invitationcode\");\r\n    },\r\n    goExchange() {\r\n      this.$router.push(\"/exchange\");\r\n    },\r\n\r\n    addressIn() {\r\n      this.isAddress = true;\r\n    },\r\n\r\n    layout() {\r\n      localStorage.removeItem(\"token\");\r\n      localStorage.setItem(\"shops\", \"[]\");\r\n      this.$router.push(\"/Login\");\r\n    },\r\n    goBack() {\r\n      this.$router.go(-1);\r\n      // let data = {}\r\n      // this.$store.dispatch(\"getMsgList\", data);\r\n    },\r\n\r\n    getMsg() {\r\n      let data = {};\r\n      apiGetUserInfo(data, true).then(res => {\r\n        //有token要加ture\r\n        this.msgList = res;\r\n        this.msgList.UImg = res.UImg;\r\n        localStorage.setItem(\"RankId\", res.RankId);\r\n        localStorage.setItem(\"nickName\", res.NickName);\r\n        localStorage.setItem(\"UImg\", res.UImg);\r\n      });\r\n    },\r\n\r\n    getMsgNum() {\r\n      let data = {};\r\n      apiGetUnreadMessageCount(data, true).then(res => {\r\n        this.msgCount = res.UnreadMessageCount;\r\n        if (this.msgCount > 0) {\r\n          this.countNum = true;\r\n        }\r\n      });\r\n    },\r\n\r\n    getUnclaimedTaskReward() {\r\n      let data = {};\r\n      apiGetMissionUnGet(data, true).then(res => {\r\n        this.unclaimedTaskReward = res.Count;\r\n      });\r\n    },\r\n    // 上传图片\r\n    updataImg(e) {\r\n      var file = e.target.files[0];\r\n      // 获取图片的大小，做大小限制有用\r\n      let imgSize = file.size;\r\n      //图片压缩就是处理file\r\n\r\n      this.imgPreview(file);\r\n\r\n      var _this = this; // this指向问题，所以在外面先定义\r\n      if (imgSize <= 1024 * 1024) {\r\n\r\n        const imgName = JSON.stringify(file.name);\r\n        let param = new FormData(); // 创建form对象\r\n        param.append(\"file\", file, file.name); // 通过append向form对象添加数据\r\n        let config = {\r\n          headers: {\r\n            \"Content-Type\": \"multipart/form-data\"\r\n          }\r\n        };\r\n        let urlL = process.env.VUE_APP_API_BASE_URL + \"/Uploader/UploadImg\";\r\n        //  添加请求头\r\n        axios.post(urlL, param, config).then(response => {\r\n          if (response.status == 200) {\r\n            // 成功上传后处理逻辑\r\n            this.msgMsg = response.data.Msg;\r\n            this.msgList.UImg = response.data.Data.Url;\r\n            this.$Alert.showSuccess.call(this, this.msgMsg);\r\n            let data = {\r\n              UImg: this.msgList.UImg\r\n            };\r\n            apiUploadImg(data, true).then(res => {\r\n              if (res.Status == 1) {\r\n                // localStorage.setItem('imgs', this.imgUrl)\r\n              }\r\n            });\r\n          }\r\n        });\r\n      } else {\r\n        this.$Alert.showWarning.call(this, \"图片太大啦！\");\r\n      }\r\n    },\r\n    imgPreview(file) {\r\n      let self = this;\r\n      let Orientation;\r\n      // 创建一个reader\r\n      let reader = new FileReader();\r\n      // 将图片2将转成 base64 格式\r\n      reader.readAsDataURL(file);\r\n      reader.onloadend = function() {\r\n        let result = this.result;\r\n        let img = new Image();\r\n        img.src = result;\r\n        //判断图片是否大于100K,是就直接上传，反之压缩图片\r\n        if (this.result.length <= 1024 * 1024) {\r\n          self.headerImage = this.result;\r\n        } else {\r\n          img.onload = function() {\r\n            let data = self.compress(img, Orientation);\r\n            self.headerImage = data;\r\n          };\r\n        }\r\n      };\r\n    },\r\n    compress(img, Orientation) {\r\n      let canvas = document.createElement(\"canvas\");\r\n      let ctx = canvas.getContext(\"2d\");\r\n      //瓦片canvas\r\n      let tCanvas = document.createElement(\"canvas\");\r\n      let tctx = tCanvas.getContext(\"2d\");\r\n      let initSize = img.src.length;\r\n      let width = img.width;\r\n      let height = img.height;\r\n      //如果图片大于四百万像素，计算压缩比并将大小压至400万以下\r\n      let ratio;\r\n      if ((ratio = (width * height) / 4000000) > 1) {\r\n        ratio = Math.sqrt(ratio);\r\n        width /= ratio;\r\n        height /= ratio;\r\n      } else {\r\n        ratio = 1;\r\n      }\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n      //        铺底色\r\n      ctx.fillStyle = \"#fff\";\r\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n      //如果图片像素大于100万则使用瓦片绘制\r\n      let count;\r\n      if ((count = (width * height) / 1000000) > 1) {\r\n        count = ~~(Math.sqrt(count) + 1); //计算要分成多少块瓦片\r\n        //            计算每块瓦片的宽和高\r\n        let nw = ~~(width / count);\r\n        let nh = ~~(height / count);\r\n        tCanvas.width = nw;\r\n        tCanvas.height = nh;\r\n        for (let i = 0; i < count; i++) {\r\n          for (let j = 0; j < count; j++) {\r\n            tctx.drawImage(\r\n              img,\r\n              i * nw * ratio,\r\n              j * nh * ratio,\r\n              nw * ratio,\r\n              nh * ratio,\r\n              0,\r\n              0,\r\n              nw,\r\n              nh\r\n            );\r\n            ctx.drawImage(tCanvas, i * nw, j * nh, nw, nh);\r\n          }\r\n        }\r\n      } else {\r\n        ctx.drawImage(img, 0, 0, width, height);\r\n      }\r\n      //修复ios上传图片的时候 被旋转的问题\r\n      if (Orientation != \"\" && Orientation != 1) {\r\n        switch (Orientation) {\r\n          case 6: //需要顺时针（向左）90度旋转\r\n            this.rotateImg(img, \"left\", canvas);\r\n            break;\r\n          case 8: //需要逆时针（向右）90度旋转\r\n            this.rotateImg(img, \"right\", canvas);\r\n            break;\r\n          case 3: //需要180度旋转\r\n            this.rotateImg(img, \"right\", canvas); //转两次\r\n            this.rotateImg(img, \"right\", canvas);\r\n            break;\r\n        }\r\n      }\r\n      //进行最小压缩\r\n      let ndata = canvas.toDataURL(\"image/jpeg\", 0.1);\r\n      //\"压缩前：\" + initSize\r\n      //\"压缩后：\" + ndata.length\r\n      //\"压缩率：\" + ~~((100 * (initSize - ndata.length)) / initSize) + \"%\"\r\n      tCanvas.width = tCanvas.height = canvas.width = canvas.height = 0;\r\n      return ndata;\r\n    },\r\n\r\n    // 語系初始化\r\n    langInit() {\r\n      this.language = JSON.parse(localStorage.getItem(\"lang\")).name;\r\n    },\r\n\r\n    // 語系彈窗選擇\r\n    langChoice(index) {\r\n      this.langIndex = index;\r\n    },\r\n\r\n    // 關閉語系選擇彈窗\r\n    cancel() {\r\n      this.showLan = false;\r\n    },\r\n\r\n    // 確定選擇語言\r\n    confirm() {\r\n      if (this.langIndex == 0) {\r\n        localStorage.setItem(\"lang\", JSON.stringify({ name: \"简体中文\", tag: \"zh-CN\" }));\r\n      } else if (this.langIndex == 1) {\r\n        localStorage.setItem(\"lang\", JSON.stringify({ name: \"繁體中文\", tag: \"zh-TW\" }));\r\n      }\r\n      else if (this.langIndex == 2) {\r\n        localStorage.setItem(\"lang\", JSON.stringify({ name: \"English\", tag: \"en-US\" }));\r\n      }\r\n      location.reload();\r\n    },\r\n\r\n    // 競猜指南暫時用確認按鈕\r\n    ComingSoon() {\r\n      this.showGuide = false;\r\n    },\r\n    //跳轉登入頁\r\n    login() {\r\n      this.$router.push(\"/Login\");\r\n    }\r\n  },\r\n  mounted() {\r\n    if (this.token) {\r\n      this.getMsg();\r\n      this.getMsgNum();\r\n      this.getUnclaimedTaskReward();\r\n    }\r\n    this.langInit();\r\n  },\r\n  created() {\r\n    localStorage.getItem(\"token\") ? this.token = true : this.token = false;\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.bigImgs {\r\n  position: absolute;\r\n  width: 1.85rem;\r\n  height: 1.4rem;\r\n  margin-left: -0.32rem;\r\n  /* z-index: 900000 */\r\n}\r\n\r\n.bestWord {\r\n  font-size: 0.24rem;\r\n  line-height: 0.4rem;\r\n  color: #f09843;\r\n  position: absolute;\r\n  top: 0.18rem;\r\n  left: -0.16rem;\r\n  z-index: 9;\r\n  font-weight: bold;\r\n}\r\n</style>\r\n"]}]}