{"remainingRequest":"C:\\work\\竞猜可换色板\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\work\\竞猜可换色板\\src\\views\\club\\MemberManagement.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\work\\竞猜可换色板\\src\\views\\club\\MemberManagement.vue","mtime":1604629890569},{"path":"C:\\work\\竞猜可换色板\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\work\\竞猜可换色板\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\work\\竞猜可换色板\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\work\\竞猜可换色板\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\work\\竞猜可换色板\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport back from \"@/components/Botton/back.vue\";\r\nimport model from \"@/components/model\";\r\nimport { apiGetMyClubManagement, apiAuditClubMem, apiGetClubRole, apiModifyClubRole } from \"@/api/Club.js\";\r\nexport default {\r\n  name: \"memberManagement\",\r\n  components: {\r\n    back,\r\n    model,\r\n  },\r\n  data() {\r\n    return {\r\n      totalMembers: 0,\r\n      yesterdayAdd: 0,\r\n      btnChoice: 0,\r\n      closedIndex: undefined,\r\n      isOpen: false,\r\n      clubId: undefined,\r\n      UName: \"\",\r\n      UId: \"\",\r\n      underReviewNum: undefined,\r\n      type: 0,\r\n      memberList: [],\r\n      unMemberList: [],\r\n      pkId: undefined,\r\n      callBackMsg: \"\",\r\n      clubRoleList: [],\r\n      clubRole: \"\",\r\n      isOpenChat: false,\r\n    };\r\n  },\r\n  created() {\r\n    // 獲取clubId\r\n    this.clubId = localStorage.getItem(\"ClubId\");\r\n\r\n    // 獲取成員管理數據\r\n    this.getMyClubManagement();\r\n  },\r\n  methods: {\r\n    allMember() {\r\n      this.btnChoice = 0;\r\n      this.getMyClubManagement();\r\n    },\r\n    underReview() {\r\n      this.btnChoice = 1;\r\n      this.getMyClubManagement();\r\n    },\r\n\r\n    // 開啟彈窗\r\n    openFancyBox(type) {\r\n      this.isOpen = true;\r\n      this.type = type;\r\n\r\n      // type = 1 ， 點選會員進階跳出彈窗時，需跑API撈取升級資訊列表\r\n      if (type == 1) {\r\n        apiGetClubRole(\"\", true).then(res => {\r\n          this.clubRoleList = res.Data;\r\n      });\r\n      }\r\n    },\r\n\r\n    // type : 1 = 升級修改會員; 2 = 移除會員; 3 = 通過審核; 4 = 拒絕審核\r\n    async confirmBtnEvent(type) {\r\n      if (type === 1) {\r\n        let data = {\r\n          UId: this.UId,\r\n          RoleId: this.clubRole\r\n        }\r\n        apiModifyClubRole(data, true).then(res => {\r\n          if (res.Success) {\r\n            this.type = 5;\r\n            this.callBackMsg = this.$t(\"SuccessfulOperation\");\r\n          }else {\r\n            this.type = 5;\r\n            this.callBackMsg = res.Message;\r\n          }\r\n      });\r\n      }\r\n      if (type === 2) {\r\n        let data = {\r\n          MemClubChangeId: this.pkId,\r\n          ClubId: this.clubId,\r\n          UId: this.UId,\r\n          Type: 2, // 2 踢人\r\n          Status: 1 // status = 1是同意  2是不同意\r\n        };\r\n        await apiAuditClubMem(data, true)\r\n          .then(res => {\r\n            if (res.Success) {\r\n              this.type = 5;\r\n              this.callBackMsg = this.$t(\"SuccessfulOperation\");\r\n            } else {\r\n              this.type = 5;\r\n              this.callBackMsg = res.Message;\r\n            }\r\n          })\r\n          .then(() => {\r\n            this.getMyClubManagement();\r\n          });\r\n      }\r\n      if (type === 3) {\r\n        let data = {\r\n          MemClubChangeId: this.pkId,\r\n          ClubId: this.clubId,\r\n          UId: this.UId,\r\n          Type: 0, // 0 審核\r\n          Status: 1 // status = 1是同意  2是不同意\r\n        };\r\n        await apiAuditClubMem(data, true)\r\n          .then(res => {\r\n            if (res.Success) {\r\n              this.type = 5;\r\n              this.callBackMsg = this.$t(\"SuccessfulOperation\");\r\n            } else {\r\n              this.type = 5;\r\n              this.callBackMsg = res.Message;\r\n            }\r\n          })\r\n          .then(() => {\r\n            this.getMyClubManagement();\r\n          });\r\n      }\r\n      if (type === 4) {\r\n          let data = {\r\n          MemClubChangeId: this.pkId,\r\n          ClubId: this.clubId,\r\n          UId: this.UId,\r\n          Type: 0, // 0 審核\r\n          Status: 2 // status = 1是同意  2是不同意\r\n        };\r\n        await apiAuditClubMem(data, true)\r\n          .then(res => {\r\n            if (res.Success) {\r\n              this.type = 5;\r\n              this.callBackMsg = this.$t(\"SuccessfulOperation\");\r\n            } else {\r\n              this.type = 5;\r\n              this.callBackMsg = res.Message;\r\n            }\r\n          })\r\n          .then(() => {\r\n            this.getMyClubManagement();\r\n          });\r\n      }\r\n      // 回傳訊息\r\n      if (type === 5) {\r\n        this.isOpen = false;\r\n      }\r\n\r\n      // 無會員錯誤訊息\r\n      if (type === 6) {\r\n        this.$router.push(\"/CreateClub\");\r\n      }\r\n\r\n      this.getMyClubManagement();\r\n    },\r\n\r\n    // 獲取成員管理數據\r\n    getMyClubManagement() {\r\n      let data = {\r\n        ClubId: this.clubId\r\n      };\r\n      apiGetMyClubManagement(data, true).then(res => {\r\n        // 無會員時跳出彈窗錯誤訊息\r\n        if(res.Code) {\r\n          this.isOpen = true;\r\n          this.type = 6;\r\n          this.callBackMsg = res.Message;\r\n          return;\r\n        }\r\n        this.memberList = res.Data.Members;\r\n        this.unMemberList = res.Data.UnMembers;\r\n        this.totalMembers = res.Data.PeoNum;\r\n        this.yesterdayAdd = res.Data.YesterdayPeoNum;\r\n\r\n        this.underReviewNum = this.unMemberList.length;\r\n      })\r\n    },\r\n\r\n    // 發送訊息\r\n    openChat() {\r\n      this.isOpenChat = true\r\n    }\r\n  }\r\n};\r\n",null]}