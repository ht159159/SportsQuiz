{"remainingRequest":"C:\\work\\竞猜可换色板\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\work\\竞猜可换色板\\src\\views\\Shop.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\work\\竞猜可换色板\\src\\views\\Shop.vue","mtime":1605491181309},{"path":"C:\\work\\竞猜可换色板\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\work\\竞猜可换色板\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\work\\竞猜可换色板\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\work\\竞猜可换色板\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\work\\竞猜可换色板\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport inputComp from \"@/components/Index/Input.vue\";\r\nimport NavBottom from \"@/components/Main/NavBottom.vue\";\r\nimport {\r\n  apiGetCategoryRecord,\r\n  apiGetGoodsRecordList,\r\n  apiAddCashInformation\r\n} from \"@/api/product.js\";\r\nimport { apiGetUserAddress, apiAddEditMemAddress } from \"@/api/User.js\";\r\nimport Vue from \"vue\";\r\nimport { Notify, Toast, Field, Image, Button } from \"vant\";\r\n\r\nVue.use(Notify)\r\n  .use(Toast)\r\n  .use(Field)\r\n  .use(Image);\r\nexport default {\r\n  //  从List组件离开时,修改keepAlive值为false，保证进入该页面时页面刷新  to===> 去哪个路由  from ==>从哪个路由来\r\n  // beforeRouteEnter(to, from, next) {\r\n  //   if (from.name !== \"shopList\") {\r\n  //     next(vm => {\r\n  //       vm._data.show = false;\r\n  //     });\r\n  //   } else {\r\n  //     next(vm => {\r\n  //       vm._data.show = true;\r\n  //     });\r\n  //   }\r\n  // },\r\n  name: \"shop\",\r\n  components: {\r\n    NavBottom\r\n  },\r\n  filters: {\r\n    wayW(val, that) {\r\n      if (val == 1) {\r\n        return that.$t(\"Coins\");\r\n      } else {\r\n        return that.$t(\"LotteryTicket\");\r\n      }\r\n    }\r\n  },\r\n  watch: {\r\n    $route() {\r\n      let listArr = JSON.stringify(this.shopsList);\r\n      // debugger\r\n      if (listArr == \"[]\") {\r\n      } else {\r\n        // 這邊切換商城及切換其他頁面時候會瘋狂報錯，先加個判斷限制一下，原因是上面的 \"listArr\"陣列第0及第3個 值為空\r\n        if (this.shopsList[0] == undefined || this.shopsList[2] == undefined) {\r\n          return;\r\n        } else {\r\n          var aid = this.shopsList[0];\r\n          var oldAid = JSON.parse(localStorage.getItem(\"shops\"))[0];\r\n          if (aid != oldAid) {\r\n            this.shopsList = JSON.parse(localStorage.getItem(\"shops\"));\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      includedComponents: \"shop\",\r\n      num: 0,\r\n      priceList: [200, 500, 1000, 2000, 3000, 5000],\r\n      money: 0,\r\n      show: false,\r\n      Idd: \"\",\r\n      listShop: [],\r\n      listShopQ: [],\r\n      Num: 1,\r\n      value: \"\",\r\n      types: 1,\r\n      amountSum: \"\",\r\n      lastMoney: \"\",\r\n      ways: this.$t(\"Coins\"),\r\n      titleNm: \"\",\r\n      imgMsg: false,\r\n      shopsList: [],\r\n      img1: true,\r\n      img2: false,\r\n      isChange: 1,\r\n      that: this,\r\n      noAddressSet: false,\r\n\r\n      lang: \"\",\r\n      theme: \"\",\r\n      themeType: [\"red\", \"blue\", \"black\", \"yellow\"],\r\n      matchUrl: require(\"@/assets/shop/shop_header.png\"),\r\n\r\n      CNMatchPicUrl: {\r\n        red: require(\"@/assets/shop/shop_header.png\"),\r\n        blue: require(\"@/assets/theme-blue/shop/shop_header.png\"),\r\n        black: require(\"@/assets/theme-black/shop/shop_header.png\"),\r\n        yellow: require(\"@/assets/theme-yellow/shop/shop_header.png\")\r\n      },\r\n\r\n       EnMatchPicUrl: {\r\n        red: require(\"@/assets/shop/shop_header_US.png\"),\r\n        blue: require(\"@/assets/theme-blue/shop/shop_header_US.png\"),\r\n        black: require(\"@/assets/theme-black/shop/shop_header_US.png\"),\r\n        yellow: require(\"@/assets/theme-yellow/shop/shop_header_US.png\")\r\n      },\r\n\r\n      TWMatchPicUrl: {\r\n        red: require(\"@/assets/shop/shop_header_TW.png\"),\r\n        blue: require(\"@/assets/theme-blue/shop/shop_header_TW.png\"),\r\n        black: require(\"@/assets/theme-black/shop/shop_header_TW.png\"),\r\n        yellow: require(\"@/assets/theme-yellow/shop/shop_header_TW.png\")\r\n      },\r\n    };\r\n  },\r\n  created() {\r\n    console.log('fsdfsdf')\r\n    this.lang = JSON.parse(localStorage.getItem(\"lang\")).tag;\r\n    this.theme = localStorage.getItem(\"theme\");\r\n    this.section();\r\n    this.changePri(3);\r\n    this.getAddMsg();\r\n  },\r\n  mounted() {\r\n    console.log('fsdfsdf')\r\n    this.changePic();\r\n  },\r\n  methods: {\r\n    changePic() {\r\n      if (this.lang == \"zh-CN\" || this.lang == \"zh-TW\") {\r\n        for (let i of this.themeType) {\r\n          if (i == this.theme) {\r\n            this.matchUrl = this.CNMatchPicUrl[i];\r\n            // this.matchPopUrl = this.CNMatchPopPicUrl[i];\r\n          }\r\n        }\r\n      }\r\n      if (this.lang == \"en-US\") {\r\n        for (let i of this.themeType) {\r\n          if (i == this.theme) {\r\n            this.matchUrl = this.EnMatchPicUrl[i];\r\n            // this.matchPopUrl = this.EnMatchPopPicUrl[i];\r\n          }\r\n        }\r\n      }\r\n      if (this.lang == \"zh-TW\") {\r\n        for (let i of this.themeType) {\r\n          if (i == this.theme) {\r\n            this.matchUrl = this.TWMatchPicUrl[i];\r\n            // this.matchPopUrl = this.EnMatchPopPicUrl[i];\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    downNum() {\r\n      if (this.Num > 99) {\r\n        const m = this.$message({\r\n          message: this.$t(\"RedeemSingle\"),\r\n          type: \"warning\",\r\n          center: true,\r\n          duration: 1000\r\n        });\r\n        setTimeout(() => m.close(), 1200);\r\n        this.Num = 99;\r\n      }\r\n    },\r\n    goAddress() {\r\n      let data = {};\r\n      apiGetUserAddress(data, true).then(res => {\r\n        if (res.Data.length > 0) {\r\n          this.$router.push(\"/shopList\");\r\n        } else {\r\n          this.$router.push(\"/address\");\r\n        }\r\n      });\r\n    },\r\n    cancel() {\r\n      this.show = false;\r\n    },\r\n    queryChange(name, id) {\r\n      this.titleNm = name;\r\n      this.show = true;\r\n      this.lastMoney = this.amountSum;\r\n      this.$refs.son.show = false;\r\n      this.getAddMsg();\r\n    },\r\n    commit() {\r\n      this.$refs.son.show = false;\r\n      let Token = localStorage.getItem(\"token\");\r\n      if (\r\n        this.shopsList[1] == undefined || this.shopsList[1] == \"\" ||\r\n        this.shopsList[2] == undefined || this.shopsList[2] == \"\" ||\r\n        this.shopsList[4] == undefined || this.shopsList[4] == \"\"\r\n      ) {\r\n        Notify({\r\n          type: \"warning\",\r\n          message: this.$t(\"AllMustFilled\")\r\n        });\r\n        return;\r\n      }\r\n      let data = {\r\n        Name: this.shopsList[1],\r\n        Phone: this.shopsList[2],\r\n        Address: this.shopsList[4],\r\n        IdentityCard: \"\",\r\n        CashNum: this.Num,\r\n        Type: this.types,\r\n        Lotteries: this.amountSum,\r\n        Uid: \"\",\r\n        GoodDescription: this.titleNm,\r\n        Status: 0,\r\n        CreateTime: new Date(),\r\n        AuditTime: \"\",\r\n        AuditName: \"\"\r\n      };\r\n\r\n      if (data.CashNum < 0 || !/^\\d+$/.test(this.Num)) {\r\n        const m = this.$message({\r\n          message: this.$t(\"FillPositiveInteger\"),\r\n          type: \"warning\",\r\n          center: true,\r\n          duration: 1200\r\n        });\r\n        setTimeout(() => m.close(), 1200);\r\n        this.Num = parseInt(this.Num);\r\n        return;\r\n      }\r\n      if(this.noAddressSet){\r\n        console.log(\"5256555\")\r\n        let addressSetData = {\r\n          AId: '',\r\n          UId: '',\r\n          UName: this.shopsList[1],\r\n          UPhoneNumber: this.shopsList[2],\r\n          URedeemAddress: this.shopsList[4],\r\n          IdentityCard: '123123',\r\n          CreateTime: new Date(),\r\n          IsDefault: 0,\r\n        }\r\n        apiAddEditMemAddress(addressSetData, true).then(res => {\r\n\r\n        })\r\n      }\r\n\r\n      apiAddCashInformation(data, true).then(res => {\r\n        if (res.IsSuccess) {\r\n          this.Num = 1;\r\n          this.show = false;\r\n          const m = this.$message({\r\n            message: this.$t(\"SuccessfulPurchase\"),\r\n            type: \"success\",\r\n            center: true,\r\n            duration: 1200\r\n          });\r\n          setTimeout(() => m.close(), 1200);\r\n        } else {\r\n          this.show = false;\r\n          // this.$Alert.showError.call(this, '购买失败')\r\n          const m = this.$message({\r\n            message: this.$t(\"FailedPurchase\"),\r\n            type: \"error\",\r\n            duration: 2000\r\n          });\r\n          setTimeout(() => m.close(), 2000);\r\n        }\r\n      });\r\n    },\r\n    getAddMsg() {\r\n      let data = {};\r\n      apiGetUserAddress(data, true).then(res => {\r\n        // debugger\r\n        if (res.Data.length > 0) {\r\n          this.noAddressSet = false;\r\n          let listAdd = res.Data;\r\n          let newObj = {};\r\n          for (let i = 0; i < listAdd.length; i++) {\r\n            if (listAdd[i].IsDefault == 1) {\r\n              newObj = listAdd[i];\r\n            }\r\n          }\r\n          let arr = [];\r\n          for (let j in newObj) {\r\n            arr.push(newObj[j]);\r\n          }\r\n\r\n          if (arr.length == 0) {\r\n            this.shopsList[1] = res.Data[0].UName;\r\n            this.shopsList[2] = res.Data[0].UPhoneNumber;\r\n            this.shopsList[4] = res.Data[0].URedeemAddress;\r\n          } else {\r\n            this.shopsList[1] = arr[2];\r\n            this.shopsList[2] = arr[3];\r\n            this.shopsList[4] = arr[4];\r\n          }\r\n        } else {\r\n          this.shopsList = [];\r\n          this.noAddressSet = true;\r\n        }\r\n      });\r\n    },\r\n    changeM() {\r\n      this.num = 0;\r\n      this.types = 1;\r\n      // this.imgIcon = require(\"@/assets/jinbi.png\");\r\n      // this.imgIcon1 = require(\"@/assets/jiang.png\");\r\n      this.isChange = 1;\r\n      this.getCommut();\r\n    },\r\n    changeQ() {\r\n      this.num = 1;\r\n      this.types = 2;\r\n      this.img2 = !this.img2;\r\n      // this.imgIcon = require(\"@/assets/jinbi1.png\");\r\n      // this.imgIcon1 = require(\"@/assets/jiang1.png\");\r\n      this.isChange = 2;\r\n      this.getCommut();\r\n    },\r\n    moneyC(index) {\r\n      this.money = index;\r\n      this.$refs.son.show = false;\r\n    },\r\n    section() {\r\n      apiGetCategoryRecord().then(res => {\r\n        this.priceList = res.Data;\r\n      });\r\n    },\r\n    changePri(id) {\r\n      this.Idd = id;\r\n      if (id == 3) {\r\n        this.amountSum = 200;\r\n      }\r\n      if (id == 4) {\r\n        this.amountSum = 500;\r\n      }\r\n      if (id == 5) {\r\n        this.amountSum = 1000;\r\n      }\r\n      if (id == 6) {\r\n        this.amountSum = 2000;\r\n      }\r\n      if (id == 7) {\r\n        this.amountSum = 3000;\r\n      }\r\n      if (id == 8) {\r\n        this.amountSum = 5000;\r\n      }\r\n      this.getCommut();\r\n    },\r\n    getCommut() {\r\n      let data = {\r\n        categoryId: this.Idd,\r\n        index: 1,\r\n        count: 10,\r\n        type: this.types //金币兑换 2奖券兑换\r\n      };\r\n      apiGetGoodsRecordList(data).then(res => {\r\n        this.listShop = res.Data;\r\n        this.$forceUpdate();\r\n        if (this.listShop.length == 0) {\r\n          this.imgMsg = true;\r\n        } else {\r\n          this.imgMsg = false;\r\n          this.listShop = res.Data;\r\n        }\r\n      });\r\n    }\r\n  },\r\n  computed: {\r\n    // amountSum() {\r\n    //   return\r\n    //     this.priceList.filter(c=>c.categoryId==this.Idd)\r\n    // },\r\n  },\r\n  //可以在此进行强制数据刷新。\r\n  activated() {\r\n    // this.getAddMsg()\r\n  }\r\n};\r\n",null]}